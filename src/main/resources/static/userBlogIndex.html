<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="css/userBlogIndex.css" rel="stylesheet">
    <link href="css/indexTop.css" rel="stylesheet">
    <link href="css/indexBottom.css" rel="stylesheet">
</head>
<script src="js/vue.min.js"></script>
<script src="js/jquery-3.4.1.js"></script>
<body>
    <div class="top">
    <div class="w">
        <div class="logo">
            <img src="images/blogIndex/logo.png">
        </div>
        <div class="nav">
            <li><a href="blogIndex.html">首页</a></li>
            <li><a href="blogIndex.html">博客</a></li>
            <li><a href="downloadhomepage.html">下载</a></li>
            <li><a href="vipBuy.html">会员</a></li>
            <li><a href="fileUpload.html">上传</a></li>
            <li><a href="blogIndex.html">论坛</a></li>
            <li><a href="blogIndex.html">商城</a></li>
            <li><a href="blogIndex.html">问答</a></li>
            <li><a href="blogIndex.html">课程</a></li>
            <li><a href="blogIndex.html">客服</a></li>
        </div>
        <form id="search">
            <div class="searchtext">
                <input type="text" id="searchtext" value="搜索框">
            </div>
            <input type="submit" class="searchbutton" value="搜索">
        </form>
        <div class="write">
            <a href="#">
                写&nbsp;博&nbsp;客
            </a>
        </div>
        <div class="login">
            <!--                <li><a href="blogIndex.html">登录</a></li>-->
            <!--                <li><a href="blogIndex.html">注册</a></li>-->
            <li><a href="#">消息</a></li>
            <a href="userInfoIndex.html">
                <div class="loginheadpic">
                    <img src="images/headpic.jpg">
                </div>
            </a>
        </div>
    </div>
</div>
    <div class="main">
        <div class="w">
            <div class="leftinfo"  id="vue_leftinfo">
                <div class="userinfo">
                    <div class="userpic">
                        <img src="images/headpic.jpg">
                    </div>
                    <div class="username">
                        <span>{{username}}</span>
                    </div>
                </div>
                <div class="someinfo">
                    <div class="fourinfo">
                        <li>博客</li>
                        <li>{{blogCount}}</li>
                    </div>
                    <div class="fourinfo">
                        <li>关注</li>
                        <li>{{blogerCount}}</li>
                    </div>
                    <div class="fourinfo">
                        <li>粉丝</li>
                        <li>{{fansCount}}</li>
                    </div>
                    <div class="fourinfo">
                        <li>评论</li>
                        <li>0</li>
                    </div>
                </div>
                <div class="manageBlog">
                    <a href="blogManage.html"><li>管理博客</li></a>
                </div>
                <div class="leftbottom">
                    <img src="images/blogIndex/leftbottom.png">
                </div>
            </div>
            <div class="blog" id="vue_blog">
                <li v-for="(b , index) in blogs">
                    <div class="blogtitle">
                        文章标题:{{b.blogTitle}}
                    </div>
                    <div class="bloginfo">
                        <div class="blogcontent">
                            文章部分内容:{{b.blogContent}}
                        </div>
                        <div class="blogauthor">
                            <div class="authorpic">
                                <img :src="userinfo.userPic" style="width: 70px">
                            </div>
                            <div class="authorname">
                                <span>作者用户名:</span>
                                <span class="ajax_userName">{{b.blogAuthor}}</span>
                            </div>
                            <div class="blogreadnum">
                                博客阅读量 {{b.blogReadNum}} 丨<a href="#">评论</a>
                            </div>
                        </div>
                    </div>
                </li>
            </div>
        </div>
    </div>
</body>
<script>
    (function ($) {
        $.getUrlParam = function (name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
            var r = window.location.search.substr(1).match(reg);
            if (r != null) return unescape(r[2]); return "";
        }
    })(jQuery);
    function getParameter(){
        var reg_int=/^[0-9]+$/;
        var key;
        var  xx = $.getUrlParam('userId') + $.getUrlParam('userName');
        if(reg_int.test(xx)){
            key = parseInt(xx);
        }else {
            key = xx;
        }
        return key;
    }
    function displaypage(len){
        if(len == 1){
            $("#vue_blog").hide();
        }else {
            $("#vue_blog").show();
        }
    }
    var userId = 0;
    var vueblog = new Vue({
        el:"#vue_blog",
        data:{
            blogs:[],
            userinfo:{}
        }
    });
    var vueleftinfo = new Vue({
        el:"#vue_leftinfo",
        data:{
            blogCount:0,
            blogerCount:0,
            fansCount:0,
            username:"",
        }
    });
    function init(){
        var userParameter = getParameter();
        var userField = jQuery.isNumeric(userParameter) ? "userId" : "userName";
        if(jQuery.isNumeric(userParameter)){
            $.ajax({
                url: "http://localhost:8080/selectUidUsafeUinfoBlog",
                type: "post",
                data: {"userId": userParameter},
                dataType: "json",
                success: function (data) {
                    vueblog.usersafe = {
                        userId: data.userId,
                        userName: data.userName,
                        password: data.password,
                        userEmail: data.userEmail,
                        userTel: data.userTel,
                        userStatus: data.userStatus,
                        userMoney: data.userMoney,
                        userIntegral: data.userIntegral,
                        userRole: data.userRole,
                    };

                    vueleftinfo.username = data.userName;

                    vueblog.userinfo = {
                        userId: data.userinfo.userId,
                        realName: data.userinfo.realName,
                        userSex: data.userinfo.userSex,
                        userBirthday: data.userinfo.userBirthday,
                        userPic: "face/"+data.userinfo.userPic,
                        userCreateTime: data.userinfo.userCreateTime,
                    };
                    vueleftinfo.blogCount = data.blogList.length;
                    for (var i = 0; i < data.blogList.length; i++) {
                        vueblog.blogs.push({
                            blogTitle: data.blogList[i].blogTitle,
                            blogCreateTime: data.blogList[i].blogCreateTime,
                            blogPubType: data.blogList[i].blogPubType,
                            blogReadNum: data.blogList[i].blogReadNum,
                            blogContent: data.blogList[i].blogContent,
                            blogAuthor:data.userName
                        })
                    }
                    $.ajax({
                        url: "http://localhost:8080/selectBlogerCount",
                        type: "get",
                        data: {"fansId": data.userId},
                        dataType: "json",
                        success: function (data) {
                            vueleftinfo.blogerCount = data;
                        }
                    });
                    $.ajax({
                        url: "http://localhost:8080/selectFansCount",
                        type: "get",
                        data: {"blogerId": data.userId},
                        dataType: "json",
                        success: function (data) {
                            vueleftinfo.fansCount = data;
                        }
                    })
                }
            })
        }else {
            $.ajax({
                url: "http://localhost:8080/selectUnameUsafeUinfoBlog",
                type: "post",
                data: {"userName": userParameter},
                dataType: "json",
                success: function (data) {
                    vueblog.usersafe = {
                        userId: data.userId,
                        userName: data.userName,
                        password: data.password,
                        userEmail: data.userEmail,
                        userTel: data.userTel,
                        userStatus: data.userStatus,
                        userMoney: data.userMoney,
                        userIntegral: data.userIntegral,
                        userRole: data.userRole,
                    };

                    vueleftinfo.username = data.userName;

                    vueblog.userinfo = {
                        userId: data.userinfo.userId,
                        realName: data.userinfo.realName,
                        userSex: data.userinfo.userSex,
                        userBirthday: data.userinfo.userBirthday,
                        userPic: "face/"+data.userinfo.userPic,
                        userCreateTime: data.userinfo.userCreateTime,
                    };
                    for (var i = 0; i < data.blogList.length; i++) {
                        vueblog.blogs.push({
                            blogTitle: data.blogList[i].blogTitle,
                            blogCreateTime: data.blogList[i].blogCreateTime,
                            blogPubType: data.blogList[i].blogPubType,
                            blogReadNum: data.blogList[i].blogReadNum,
                            blogContent: data.blogList[i].blogContent,
                            blogAuthor:data.userName
                        })
                    }
                    $.ajax({
                        url: "http://localhost:8080/selectBlogerCount",
                        type: "get",
                        data: {"fansId": data.userId},
                        dataType: "json",
                        success: function (data) {
                            vueleftinfo.blogerCount = data;
                        }
                    });
                    $.ajax({
                        url: "http://localhost:8080/selectFansCount",
                        type: "get",
                        data: {"blogerId": data.userId},
                        dataType: "json",
                        success: function (data) {
                            vueleftinfo.fansCount = data;
                        }
                    })
                }
            })
        }
    }
    $(function () {
        $("#vue_blog").on("click",".ajax_userName",function () {
            var userName = $(this).text();
            var url1 = "http://localhost:8080/userBlogIndex.html?userName="+userName;
            window.location.replace(url1);
        })
        init();
        $.ajax({
            url: "/getUserInfo",
            dataType: "json",
            success: function (data) {
                $(".userpic img").attr("src", "face/" + data.userPic);
                $(".loginheadpic img").attr("src", "face/" + data.userPic);
            }
        });
    })
</script>
</html>